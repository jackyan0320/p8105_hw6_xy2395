P8105\_hw6\_xy2395
================
Jack Yan
11/16/2018

Problem 1
---------

### Data manipulation

``` r
homicide_df = 
  read_csv("./data/homicide-data.csv") %>% 
  # Create a city_state variable
  mutate(city_state = str_c(city, ", ", state),
         # Create a binary variable indicating whether the homicide is solved
         resolved = as.numeric(disposition == "Closed by arrest")) %>% 
  # Omit some cities
  filter(!city_state %in% c('Dallas, TX', 'Phoenix, AZ', 'Kansas City, MO', 'Tulsa, AL')) %>% 
  # Modifiy victim_race to have categories white and non-white, with white as the reference category. 
  filter(victim_race != "Unknown") %>% 
  mutate(victim_race = if_else(victim_race == "White", "white", "non-white"),
         victim_race = fct_relevel(victim_race, "white")) %>%
  # Be sure that victim_age is numeric
  mutate(victim_age = as.numeric(victim_age))
```

    ## Parsed with column specification:
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_integer(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_character(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

    ## Warning in evalq(as.numeric(victim_age), <environment>): NAs introduced by
    ## coercion

### Baltimore, MD

``` r
# fit a logistic regression
fit_logistic = 
  homicide_df %>% 
  filter(city_state == "Baltimore, MD") %>% 
  glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())

# obtain the estimate of OR
estimate =
  fit_logistic %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate)) %>%
  # the estimate givrn by the model is log odds ratio
  select(term, log_OR = estimate, OR, p.value) %>% 
  filter(str_detect(term, "non-white") == TRUE)

# obtain the CI of OR

ci =
  suppressWarnings(
    confint(fit_logistic) %>% broom::tidy() %>% 
    mutate('95%_CI_lower_bound' = exp(X2.5..),
           '95%_CI_upper_bound' = exp(X97.5..)) %>% 
    filter(str_detect(.rownames, "non-white") == TRUE)
  )
```

    ## Waiting for profiling to be done...

``` r
# conbine columns 
bind_cols(estimate, ci) %>% 
  mutate(city = "Baltimore, MD") %>% 
  select(city, OR, `95%_CI_lower_bound`, `95%_CI_upper_bound`)
```

    ## # A tibble: 1 x 4
    ##   city             OR `95%_CI_lower_bound` `95%_CI_upper_bound`
    ##   <chr>         <dbl>                <dbl>                <dbl>
    ## 1 Baltimore, MD 0.441                0.312                0.620

Now run glm for each of the cities in your dataset, and extract the adjusted odds ratio (and CI) for solving homicides comparing non-white victims to white victims. Do this within a “tidy” pipeline, making use of purrr::map, list columns, and unnest as necessary to create a dataframe with estimated ORs and CIs for each city.

``` r
# build a function
run_glm = function(city_name){
  # fit a logistic regression
  fit_logistic = 
    homicide_df %>% 
    filter(city_state == city_name) %>% 
    glm(resolved ~ victim_age + victim_sex + victim_race, data = ., family = binomial())
  
  # obtain the estimate of OR
  estimate =
    fit_logistic %>% 
    broom::tidy() %>% 
    mutate(OR = exp(estimate)) %>%
    # the estimate givrn by the model is log odds ratio
    select(term, log_OR = estimate, OR, p.value) %>% 
    filter(str_detect(term, "non-white") == TRUE)
  
  # obtain the CI of OR
  
  ci =
  suppressWarnings(
    confint(profile(fit_logistic)) %>% broom::tidy() %>% 
    mutate('95%_CI_lower_bound' = exp(X2.5..),
           '95%_CI_upper_bound' = exp(X97.5..)
    ) %>% 
    filter(str_detect(.rownames, "non-white") == TRUE)
  )
  # conbine columns 
  bind_cols(estimate, ci) %>% 
    mutate(city_state = city_name) %>% 
    select(city_state, OR, `95%_CI_lower_bound`, `95%_CI_upper_bound`)
}
```

``` r
result_df = 
  homicide_df %>% 
  distinct(city_state) %>% 
  .$city_state %>% 
  map_df(., run_glm) 
```

Create a plot that shows the estimated ORs and CIs for each city. Organize cities according to estimated OR, and comment on the plot.

``` r
result_df %>% 
  mutate(city_state = fct_reorder(city_state, OR)) %>% 
  ggplot(aes(x = city_state, 
             y = OR, 
             ymin = `95%_CI_lower_bound`, 
             ymax = `95%_CI_upper_bound`)
  ) +
    geom_point() +
    geom_errorbar() +
    theme(axis.text.x = element_text(angle = 90, hjust = 1, size = rel(0.8))) +
    labs(
      x = "City",
      y = "OR",
      title = "Odds ratio and CI for solving homicides comparing non-white victims to white victims"
    )
```

![](p8105_hw6_xy2395_files/figure-markdown_github/unnamed-chunk-5-1.png)

Comment:

Problem 2
---------

### Data manipulation

``` r
weight_df = 
  read_csv("./data/birthweight.csv") %>% 
  mutate(
    babysex = as.factor(babysex),
    frace = as.factor(frace),
    malform = as.factor(malform),
    mrace = as.factor(mrace)
  )
```

    ## Parsed with column specification:
    ## cols(
    ##   .default = col_integer(),
    ##   gaweeks = col_double(),
    ##   ppbmi = col_double(),
    ##   smoken = col_double()
    ## )

    ## See spec(...) for full column specifications.

``` r
str(weight_df)
```

    ## Classes 'tbl_df', 'tbl' and 'data.frame':    4342 obs. of  20 variables:
    ##  $ babysex : Factor w/ 2 levels "1","2": 2 1 2 1 2 1 2 2 1 1 ...
    ##  $ bhead   : int  34 34 36 34 34 33 33 33 36 33 ...
    ##  $ blength : int  51 48 50 52 52 52 46 49 52 50 ...
    ##  $ bwt     : int  3629 3062 3345 3062 3374 3374 2523 2778 3515 3459 ...
    ##  $ delwt   : int  177 156 148 157 156 129 126 140 146 169 ...
    ##  $ fincome : int  35 65 85 55 5 55 96 5 85 75 ...
    ##  $ frace   : Factor w/ 5 levels "1","2","3","4",..: 1 2 1 1 1 1 2 1 1 2 ...
    ##  $ gaweeks : num  39.9 25.9 39.9 40 41.6 ...
    ##  $ malform : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
    ##  $ menarche: int  13 14 12 14 13 12 14 12 11 12 ...
    ##  $ mheight : int  63 65 64 64 66 66 72 62 61 64 ...
    ##  $ momage  : int  36 25 29 18 20 23 29 19 13 19 ...
    ##  $ mrace   : Factor w/ 4 levels "1","2","3","4": 1 2 1 1 1 1 2 1 1 2 ...
    ##  $ parity  : int  3 0 0 0 0 0 0 0 0 0 ...
    ##  $ pnumlbw : int  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ pnumsga : int  0 0 0 0 0 0 0 0 0 0 ...
    ##  $ ppbmi   : num  26.3 21.3 23.6 21.8 21 ...
    ##  $ ppwt    : int  148 128 137 127 130 115 105 119 105 145 ...
    ##  $ smoken  : num  0 0 1 10 1 0 0 0 0 4 ...
    ##  $ wtgain  : int  29 28 11 30 26 14 21 21 41 24 ...

### Fit a model

`Describe your modeling process`

``` r
fit_all = lm(bwt ~ ., data = weight_df)
summary(fit_all)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ ., data = weight_df)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1097.68  -184.86    -3.33   173.09  2344.15 
    ## 
    ## Coefficients: (3 not defined because of singularities)
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -6265.3914   660.4011  -9.487  < 2e-16 ***
    ## babysex2       28.7073     8.4652   3.391 0.000702 ***
    ## bhead         130.7781     3.4523  37.881  < 2e-16 ***
    ## blength        74.9536     2.0217  37.075  < 2e-16 ***
    ## delwt           4.1007     0.3948  10.386  < 2e-16 ***
    ## fincome         0.2898     0.1795   1.614 0.106551    
    ## frace2         14.3313    46.1501   0.311 0.756168    
    ## frace3         21.2361    69.2960   0.306 0.759273    
    ## frace4        -46.9962    44.6782  -1.052 0.292912    
    ## frace8          4.2969    74.0741   0.058 0.953745    
    ## gaweeks        11.5494     1.4654   7.882 4.06e-15 ***
    ## malform1        9.7650    70.6259   0.138 0.890039    
    ## menarche       -3.5508     2.8951  -1.226 0.220083    
    ## mheight         9.7874    10.3116   0.949 0.342588    
    ## momage          0.7593     1.2221   0.621 0.534418    
    ## mrace2       -151.4354    46.0453  -3.289 0.001014 ** 
    ## mrace3        -91.3866    71.9190  -1.271 0.203908    
    ## mrace4        -56.4787    45.1369  -1.251 0.210901    
    ## parity         95.5411    40.4793   2.360 0.018307 *  
    ## pnumlbw             NA         NA      NA       NA    
    ## pnumsga             NA         NA      NA       NA    
    ## ppbmi           4.3538    14.8913   0.292 0.770017    
    ## ppwt           -3.4716     2.6121  -1.329 0.183913    
    ## smoken         -4.8544     0.5871  -8.269  < 2e-16 ***
    ## wtgain              NA         NA      NA       NA    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 272.5 on 4320 degrees of freedom
    ## Multiple R-squared:  0.7183, Adjusted R-squared:  0.717 
    ## F-statistic: 524.6 on 21 and 4320 DF,  p-value: < 2.2e-16

``` r
fit_mine = lm(bwt ~ babysex + bhead + blength + delwt + gaweeks + mrace + smoken, data = weight_df)
summary(fit_mine)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ babysex + bhead + blength + delwt + gaweeks + 
    ##     mrace + smoken, data = weight_df)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1120.47  -181.53    -6.01   173.39  2338.34 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -5814.2727    98.8293 -58.831  < 2e-16 ***
    ## babysex2       29.2229     8.4968   3.439 0.000589 ***
    ## bhead         131.8628     3.4620  38.089  < 2e-16 ***
    ## blength        75.7996     2.0220  37.488  < 2e-16 ***
    ## delwt           2.2667     0.1962  11.553  < 2e-16 ***
    ## gaweeks        11.8658     1.4619   8.117 6.19e-16 ***
    ## mrace2       -146.8837     9.2486 -15.882  < 2e-16 ***
    ## mrace3        -71.6869    42.5050  -1.687 0.091762 .  
    ## mrace4       -120.0461    18.7754  -6.394 1.79e-10 ***
    ## smoken         -4.7516     0.5885  -8.074 8.76e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 274 on 4332 degrees of freedom
    ## Multiple R-squared:  0.7144, Adjusted R-squared:  0.7138 
    ## F-statistic:  1204 on 9 and 4332 DF,  p-value: < 2.2e-16

``` r
fit_mine_1 = lm(bwt ~ babysex + bhead + blength + delwt + gaweeks + mrace + smoken + bhead*babysex + blength*babysex + bhead*blength*babysex, data = weight_df)
summary(fit_mine_1)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ babysex + bhead + blength + delwt + gaweeks + 
    ##     mrace + smoken + bhead * babysex + blength * babysex + bhead * 
    ##     blength * babysex, data = weight_df)
    ## 
    ## Residuals:
    ##     Min      1Q  Median      3Q     Max 
    ## -1115.2  -182.2    -5.1   173.4  2298.9 
    ## 
    ## Coefficients:
    ##                          Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)            -6669.3349  1211.1317  -5.507 3.87e-08 ***
    ## babysex2                5290.7019  1596.5612   3.314 0.000928 ***
    ## bhead                    157.8597    36.5846   4.315 1.63e-05 ***
    ## blength                   89.4016    25.1714   3.552 0.000387 ***
    ## delwt                      2.2344     0.1963  11.381  < 2e-16 ***
    ## gaweeks                   12.1947     1.4749   8.268  < 2e-16 ***
    ## mrace2                  -144.5904     9.2547 -15.623  < 2e-16 ***
    ## mrace3                   -70.5615    42.4283  -1.663 0.096370 .  
    ## mrace4                  -118.2597    18.7429  -6.310 3.08e-10 ***
    ## smoken                    -4.6418     0.5882  -7.892 3.74e-15 ***
    ## babysex2:bhead          -162.8007    48.6196  -3.348 0.000820 ***
    ## babysex2:blength        -102.8952    33.4124  -3.080 0.002086 ** 
    ## bhead:blength             -0.4218     0.7486  -0.563 0.573127    
    ## babysex2:bhead:blength     3.1835     1.0054   3.167 0.001553 ** 
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 273.4 on 4328 degrees of freedom
    ## Multiple R-squared:  0.7158, Adjusted R-squared:  0.715 
    ## F-statistic: 838.6 on 13 and 4328 DF,  p-value: < 2.2e-16

``` r
read_csv("./data/birthweight.csv") %>%  
  cor()
```

    ## Parsed with column specification:
    ## cols(
    ##   .default = col_integer(),
    ##   gaweeks = col_double(),
    ##   ppbmi = col_double(),
    ##   smoken = col_double()
    ## )

    ## See spec(...) for full column specifications.

    ## Warning in cor(.): the standard deviation is zero

    ##               babysex        bhead      blength          bwt        delwt
    ## babysex   1.000000000 -0.168800453 -0.105288240 -0.086641788 -0.016419382
    ## bhead    -0.168800453  1.000000000  0.630454800  0.747106776  0.214370719
    ## blength  -0.105288240  0.630454800  1.000000000  0.743450753  0.229149444
    ## bwt      -0.086641788  0.747106776  0.743450753  1.000000000  0.287889306
    ## delwt    -0.016419382  0.214370719  0.229149444  0.287889306  1.000000000
    ## fincome  -0.022642956  0.115699146  0.078745057  0.154571511  0.034994354
    ## frace     0.030927740 -0.096080105 -0.113357087 -0.179390010 -0.064849608
    ## gaweeks   0.020240367  0.378456488  0.359263675  0.412183348  0.124278465
    ## malform  -0.018032531  0.002996998 -0.009021499  0.001333249  0.012094278
    ## menarche -0.006286522 -0.003016051 -0.021067386 -0.024424664 -0.085940103
    ## mheight   0.007735868  0.116948174  0.160259849  0.192163204  0.411257622
    ## momage   -0.037178242  0.108081296  0.080160314  0.135773400  0.074040925
    ## mrace     0.036021274 -0.110141965 -0.132483530 -0.207668944 -0.092238299
    ## parity    0.022998017 -0.020039523 -0.032470081 -0.008374112 -0.004709123
    ## pnumlbw            NA           NA           NA           NA           NA
    ## pnumsga            NA           NA           NA           NA           NA
    ## ppbmi    -0.006993810  0.086556495  0.074015773  0.093945729  0.720504055
    ## ppwt     -0.001007045  0.136608829  0.148604640  0.182891964  0.870913274
    ## smoken   -0.027754251 -0.053947231 -0.065628829 -0.075627807  0.048612734
    ## wtgain   -0.031461915  0.183333740  0.191223763  0.247252588  0.424788310
    ##               fincome       frace       gaweeks       malform
    ## babysex  -0.022642956  0.03092774  0.0202403675 -0.0180325312
    ## bhead     0.115699146 -0.09608011  0.3784564882  0.0029969977
    ## blength   0.078745057 -0.11335709  0.3592636747 -0.0090214992
    ## bwt       0.154571511 -0.17939001  0.4121833483  0.0013332488
    ## delwt     0.034994354 -0.06484961  0.1242784648  0.0120942777
    ## fincome   1.000000000 -0.28459212  0.1066776727 -0.0068882129
    ## frace    -0.284592120  1.00000000 -0.1137273091 -0.0268645071
    ## gaweeks   0.106677673 -0.11372731  1.0000000000 -0.0050945358
    ## malform  -0.006888213 -0.02686451 -0.0050945358  1.0000000000
    ## menarche -0.003535085  0.02121010 -0.0004362693 -0.0098672735
    ## mheight   0.131018596 -0.20087131  0.0621377387 -0.0079746200
    ## momage    0.323114207 -0.18693410  0.1139098271  0.0177280547
    ## mrace    -0.304811707  0.82860550 -0.1315205703 -0.0276627251
    ## parity   -0.025942406  0.00117668 -0.0796588545 -0.0013177624
    ## pnumlbw            NA          NA            NA            NA
    ## pnumsga            NA          NA            NA            NA
    ## ppbmi    -0.020189000  0.04594735  0.0273358740  0.0002545075
    ## ppwt      0.047252637 -0.05961396  0.0564730379 -0.0033798843
    ## smoken    0.077943047 -0.17293364  0.0362116820  0.0331602952
    ## wtgain   -0.016037706 -0.02177121  0.1481459581  0.0307670393
    ##               menarche      mheight      momage        mrace       parity
    ## babysex  -0.0062865218  0.007735868 -0.03717824  0.036021274  0.022998017
    ## bhead    -0.0030160515  0.116948174  0.10808130 -0.110141965 -0.020039523
    ## blength  -0.0210673863  0.160259849  0.08016031 -0.132483530 -0.032470081
    ## bwt      -0.0244246642  0.192163204  0.13577340 -0.207668944 -0.008374112
    ## delwt    -0.0859401032  0.411257622  0.07404092 -0.092238299 -0.004709123
    ## fincome  -0.0035350852  0.131018596  0.32311421 -0.304811707 -0.025942406
    ## frace     0.0212101015 -0.200871313 -0.18693410  0.828605502  0.001176680
    ## gaweeks  -0.0004362693  0.062137739  0.11390983 -0.131520570 -0.079658854
    ## malform  -0.0098672735 -0.007974620  0.01772805 -0.027662725 -0.001317762
    ## menarche  1.0000000000  0.074115569  0.17603797  0.013421835  0.019476194
    ## mheight   0.0741155687  1.000000000  0.10904804 -0.230425440 -0.013423739
    ## momage    0.1760379749  0.109048035  1.00000000 -0.211600003  0.051954243
    ## mrace     0.0134218348 -0.230425440 -0.21160000  1.000000000  0.002117682
    ## parity    0.0194761938 -0.013423739  0.05195424  0.002117682  1.000000000
    ## pnumlbw             NA           NA          NA           NA           NA
    ## pnumsga             NA           NA          NA           NA           NA
    ## ppbmi    -0.1218260802 -0.100737749  0.08124512  0.034843174 -0.005926674
    ## ppwt     -0.0704995875  0.426687241  0.12959210 -0.084248225 -0.011202947
    ## smoken    0.0163746450  0.060983516  0.07545435 -0.197517866 -0.005575698
    ## wtgain   -0.0445137226  0.048478926 -0.08848760 -0.031966724  0.011081927
    ##          pnumlbw pnumsga         ppbmi         ppwt       smoken
    ## babysex       NA      NA -0.0069938102 -0.001007045 -0.027754251
    ## bhead         NA      NA  0.0865564946  0.136608829 -0.053947231
    ## blength       NA      NA  0.0740157734  0.148604640 -0.065628829
    ## bwt           NA      NA  0.0939457290  0.182891964 -0.075627807
    ## delwt         NA      NA  0.7205040550  0.870913274  0.048612734
    ## fincome       NA      NA -0.0201890000  0.047252637  0.077943047
    ## frace         NA      NA  0.0459473547 -0.059613957 -0.172933640
    ## gaweeks       NA      NA  0.0273358740  0.056473038  0.036211682
    ## malform       NA      NA  0.0002545075 -0.003379884  0.033160295
    ## menarche      NA      NA -0.1218260802 -0.070499588  0.016374645
    ## mheight       NA      NA -0.1007377489  0.426687241  0.060983516
    ## momage        NA      NA  0.0812451229  0.129592098  0.075454350
    ## mrace         NA      NA  0.0348431735 -0.084248225 -0.197517866
    ## parity        NA      NA -0.0059266742 -0.011202947 -0.005575698
    ## pnumlbw        1      NA            NA           NA           NA
    ## pnumsga       NA       1            NA           NA           NA
    ## ppbmi         NA      NA  1.0000000000  0.853316763  0.007022980
    ## ppwt          NA      NA  0.8533167629  1.000000000  0.038854748
    ## smoken        NA      NA  0.0070229798  0.038854748  1.000000000
    ## wtgain        NA      NA -0.1099295765 -0.074940321  0.027065774
    ##               wtgain
    ## babysex  -0.03146191
    ## bhead     0.18333374
    ## blength   0.19122376
    ## bwt       0.24725259
    ## delwt     0.42478831
    ## fincome  -0.01603771
    ## frace    -0.02177121
    ## gaweeks   0.14814596
    ## malform   0.03076704
    ## menarche -0.04451372
    ## mheight   0.04847893
    ## momage   -0.08848760
    ## mrace    -0.03196672
    ## parity    0.01108193
    ## pnumlbw           NA
    ## pnumsga           NA
    ## ppbmi    -0.10992958
    ## ppwt     -0.07494032
    ## smoken    0.02706577
    ## wtgain    1.00000000

### Ploting

and show a plot of model residuals against fitted values – use add\_predictions and add\_residuals in making this plot.

``` r
weight_df %>% 
  add_predictions(fit_mine) %>%
  add_residuals(fit_mine) %>%
  ggplot(aes(y = resid, x = pred)) + 
  geom_point() 
```

![](p8105_hw6_xy2395_files/figure-markdown_github/unnamed-chunk-8-1.png)

### Compare your model to two others

``` r
fit_alt_1 = lm(bwt ~ blength + gaweeks, data = weight_df)
fit_alt_2 = lm(bwt ~ bhead*blength*babysex, data = weight_df)

summary(fit_alt_1)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ blength + gaweeks, data = weight_df)
    ## 
    ## Residuals:
    ##     Min      1Q  Median      3Q     Max 
    ## -1709.6  -215.4   -11.4   208.2  4188.8 
    ## 
    ## Coefficients:
    ##              Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -4347.667     97.958  -44.38   <2e-16 ***
    ## blength       128.556      1.990   64.60   <2e-16 ***
    ## gaweeks        27.047      1.718   15.74   <2e-16 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 333.2 on 4339 degrees of freedom
    ## Multiple R-squared:  0.5769, Adjusted R-squared:  0.5767 
    ## F-statistic:  2958 on 2 and 4339 DF,  p-value: < 2.2e-16

``` r
summary(fit_alt_2)
```

    ## 
    ## Call:
    ## lm(formula = bwt ~ bhead * blength * babysex, data = weight_df)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -1132.99  -190.42   -10.33   178.63  2617.96 
    ## 
    ## Coefficients:
    ##                          Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept)            -7176.8170  1264.8397  -5.674 1.49e-08 ***
    ## bhead                    181.7956    38.0542   4.777 1.84e-06 ***
    ## blength                  102.1269    26.2118   3.896 9.92e-05 ***
    ## babysex2                6374.8684  1677.7669   3.800 0.000147 ***
    ## bhead:blength             -0.5536     0.7802  -0.710 0.478012    
    ## bhead:babysex2          -198.3932    51.0917  -3.883 0.000105 ***
    ## blength:babysex2        -123.7729    35.1185  -3.524 0.000429 ***
    ## bhead:blength:babysex2     3.8781     1.0566   3.670 0.000245 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 287.7 on 4334 degrees of freedom
    ## Multiple R-squared:  0.6849, Adjusted R-squared:  0.6844 
    ## F-statistic:  1346 on 7 and 4334 DF,  p-value: < 2.2e-16

``` r
cv_df = 
  crossv_mc(weight_df, n = 100) %>% 
  mutate(train = map(train, as_tibble),
         test  = map(test, as_tibble))

cv_df = 
  cv_df %>% 
  mutate(mine  = map(train, ~lm(bwt ~ babysex + bhead + blength + delwt + gaweeks + mrace + smoken, data = .x)),
         alt_1 = map(train, ~lm(bwt ~ blength + gaweeks, data = .x)),
         alt_2 = map(train, ~lm(bwt ~ bhead*blength*babysex, data = .x))
  ) %>% 
  mutate(rmse_mine  = map2_dbl(mine,  test, ~rmse(model = .x, data = .y)),
         rmse_alt_1 = map2_dbl(alt_1, test, ~rmse(model = .x, data = .y)),
         rmse_alt_2 = map2_dbl(alt_2, test, ~rmse(model = .x, data = .y))
  )
```

``` r
cv_df %>% 
  select(starts_with('rmse')) %>% 
  gather(key = model, value = rmse, rmse_mine:rmse_alt_2) %>% 
  group_by(model) %>% 
  ggplot(aes(x = model, y = rmse)) +
    geom_violin()
```

![](p8105_hw6_xy2395_files/figure-markdown_github/unnamed-chunk-11-1.png)
